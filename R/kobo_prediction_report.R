#' @name kobo_prediction_report
#' @rdname kobo_prediction_report
#' @title  Generate prediction
#'
#' @description  Automatically produce prediction reports
#' containing elements of descriptive analysis,
#' information about the methods used
#' (such as regression and classification) and prediction results.
#' The configuration of the function is done in an xlsform.
#' The target variables are taken from the household surveys
#' and three types of outcome will be considered:
#' binary (going to school, marry children,...),
#' numeric (expenditure per capita,…)
#' and ordinal (level of agreement, support from local community,…).
#' Then the function will train different models
#' (using the inner joint between registration and household surveys as training data)
#' and select the most accurate one.
#' The user needs to have previously loaded the registry, survey and form files
#'
#'
#'
#'
#' @param  frame odk dataset to use
#' @param registry file with registration information
#' @param dico  generated from kobo_dico)
#'
#'
#' @author Damien Seite, Edouard Legoupil
#'
#'
#' @export kobo_prediction_report
#'
#'
#'
#' @examples
#' \dontrun{
#' kobo_prediction_report("myform.xlsx")
#' }
#'





kobo_prediction_report <- function(dico, frame, registry) {


  percent <- function(x, digits = 0, format = "f", ...) {
    paste0(formatC( x, format = format, digits = digits, ...), "%")
  }

  frame <- household
  mainDirroot <- getwd()
  framename <- deparse(substitute(frame))
  progrescase <- deparse(substitute(registry))

  ## Check that all those selectedVars are in the frame ####
  check <- as.data.frame(names(frame))
  names(check)[1] <- "fullname"
  check$id <- row.names(check)



  selected.predict <- dico[ which(dico$predict == "yes" & dico$type %in% c("select_one","select_one_d",'integer')), ]
  selected.predict <- plyr::join(x = selected.predict, y = check, by = "fullname", type = "left")
  selected.predict <- subset(selected.predict, fullname %in% check$fullname)


  #selected.predict <- selected.predict[!is.na(selected.predict$id), ]
  selected.predictVars <- as.character(selected.predict[ , c("fullname")])
  #selected.clusterVars2 <- as.character(selected.cluster[ , c("name")])
  selected.predictVars2 <- stringr::str_replace_all(as.character(selected.predict[ , c("name")]), "_", ".")

  selected.id <- dico[ which(dico$predict == "id"), ]
  selected.id <- plyr::join(x = selected.id, y = check, by = "fullname", type = "left")
  selected.id <- selected.id[!is.na(selected.id$id),  ]
  selected.idVars <- as.character(selected.id[ , c("fullname")])

  survey <- frame

  ## Join Survey & Registration ######

  survey$demo.reg_question.unhcr_case_number <- as.character(subset(survey, select = selected.idVars)[,1])
  surveypro <- plyr::join(x = survey, y = progrescase, by = "demo.reg_question.unhcr_case_number", type = "inner")
  cat(round(nrow(surveypro)/nrow(progrescase)*100, digits = 1),"%", "of registered people are also in the household survey dataset" )

  if (nrow(selected.predict) == 0) { cat("You have not selected variables to predict \n") }

  #Generating a report for each variable in selected.predictVars
  for (i in 1:length(selected.predictVars)){

    variablesname <- as.character(selected.predictVars[ i ])
    cat(paste(i, " - Render chapter for ",as.character(selected.predictVars[ i ]),"\n" ))
    variable.name <- paste("code/",i,"-", variablesname, "-chapter.Rmd", sep = "")

    ## Categorical outcome #####
    if(selected.predictVars[i] %in% dico[ which(dico$fullname == selected.predictVars[i] & dico$type == "select_one" & dico$listname != "yesno" & dico$listname != "yesnono" & dico$listname != "yes_no"), ]$fullname){

      cat("---", file = variable.name , sep = "\n", append = TRUE)
      cat("title: \"Prediction report\"", file = variable.name , sep = "\n", append = TRUE)
      cat("author: \"(Categorical outcome)\"", file = variable.name , sep = "\n", append = TRUE)
      cat("date: \" `r format(Sys.Date(),  '%d %B %Y')`\"", file = variable.name , sep = "\n", append = TRUE)
      cat("output:", file = variable.name , sep = "\n", append = TRUE)
      cat("  word_document:", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_caption: yes", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_height: 5", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_width: 8", file = variable.name , sep = "\n", append = TRUE)
      cat("    reference_docx: style-unhcr-portrait.docx", file = variable.name , sep = "\n", append = TRUE)
      cat("    #toc: yes", file = variable.name , sep = "\n", append = TRUE)
      cat("    #toc_depth: 2", file = variable.name , sep = "\n", append = TRUE)
      cat("---", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r setup, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat(" mainDir <- getwd()", file = variable.name , sep = "\n", append = TRUE)
      cat(" mainDirroot <- substring(mainDir, 0 , nchar(mainDir) - 5)", file = variable.name , sep = "\n", append = TRUE)
      cat(" ## Load all required packages", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(MASS)", file = variable.name , sep = "\n", append = TRUE)
      cat("### Library ########", file = variable.name , sep = "\n", append = TRUE)
      cat("# load packages", file = variable.name , sep = "\n", append = TRUE)
      cat(" #library(RGtk2)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"ggplot2\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"corrplot\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"ROCR\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"caret\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"questionr\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(effects)", file = variable.name , sep = "\n", append = TRUE)
      cat("#need to change the path to your Java location in order to find the jvm.dll file", file = variable.name , sep = "\n", append = TRUE)
      cat(" #install.packages(\"rJava\")", file = variable.name , sep = "\n", append = TRUE)
      cat("# library(rJava)", file = variable.name , sep = "\n", append = TRUE)
      cat("# library(glmulti)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(caret)", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat("#detaching useless packages ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"MASS\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"GGally\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"xtable\")", file = variable.name , sep = "\n", append = TRUE)
      cat("# install.packages(\"sdcMicro\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(readxl)", file = variable.name , sep = "\n", append = TRUE)
      cat(" library(koboloadeR)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ROCR)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(haven)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- surveypro", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Isolating the variable of interest", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- subset(train, select = variablesname)[,1]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("try(train <- train[,-which(names(train) == variablesname)])", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- subset(train, select= colnames(progrescase))", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- as.data.frame(lapply(train, as.factor))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Remove variables will too many levels or constant", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[, sapply(train, function(col) nlevels(unique(col))) < 50] #for random forest to work", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[, sapply(train, function(col) nlevels(unique(col))) > 1] #for random forest to work", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Imputation of missing data in the variable of interest with k nearest neighbors", file = variable.name , sep = "\n", append = TRUE)
      cat("library(VIM)", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- kNN(train,  \"var\",  imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Saving the variable ", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- train$var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r variable selection, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Basic imputation method for the rest of the data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("while(anyNA(train) == TRUE){", file = variable.name , sep = "\n", append = TRUE)
      cat("  train <- hotdeck(train, imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Random Forests are used to perform variable selection", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train_Y <- train$var", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.modelselect <- randomForest(train_Y ~ . , data = train)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance <- as.data.frame(rf.modelselect$importance)", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance$label <- rownames(rf.importance)", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance <-(rf.importance[with(rf.importance, order(-MeanDecreaseGini)),])", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("selectedVars <- rf.importance$label[1:10]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#The 10 most relevant variables are selected", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- subset(train, select = selectedVars)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r creating datasets, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- var", file = variable.name , sep = "\n", append = TRUE)
      cat("#train_dicho<-hotdeck(train_dicho,imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create data for training and test ########", file = variable.name , sep = "\n", append = TRUE)
      cat("set.seed(0)", file = variable.name , sep = "\n", append = TRUE)
      cat("tr.number <- sample(nrow(train),nrow(train)*2/3)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#train<-train4", file = variable.name , sep = "\n", append = TRUE)
      cat("test <- train[-tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train_Y <- as.vector(train$var)", file = variable.name , sep = "\n", append = TRUE)
      cat("test_Y <- as.vector(test$var)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("#train<-train[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("test$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho <- as.data.frame(c(acm.disjonctif(train[,sapply(train, is.factor)]), train[sapply(train, is.numeric)]))", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho <- as.data.frame(c(acm.disjonctif(test[,sapply(test, is.factor)]), test[sapply(test, is.numeric)]))", file = variable.name , sep = "\n", append = TRUE)
      cat("  detach(\"package:VIM\", unload = TRUE)  ", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:ade4\", unload = TRUE) ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.train <- nrow(train)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Introduction", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The purpose of this section of the package is to build predictions of the variables of interest using the registration data. In practice, this means operations can predict which households are more likely to possess a certain characteristic, based on certain things those households might have in common. So, for example, if the Child Protection Unit wants to identify households at risk of child marriage for an intervention. The package takes the variable child marriage and looks at all the households where this issue exists, and finds what those households have in common. When a sample is representative, the findings, in this case, the model, can be extrapolated", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Data description", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The variable that is to be predicted is " ,variablesname, ".", file = variable.name , sep = "\n", append = TRUE)

      cat(" The variables used for prediction are taken from the registration data:  education, origin, place of asylum, occupation, family profile, case size, female ratio,", file = variable.name , sep = "\n", append = TRUE)
      cat("dependency, marital status and year of arrival in the country of asylum. The dataset gathers ",nrow(survey)," individuals", file = variable.name , sep = "\n", append = TRUE)
      cat("This variable is present in the household survey dataset, while the variables used for prediction are taken from the registration data (or proGres database). A statistical model called a random forest model was used to select the registration variables which most closely correlate to " ,variablesname, "(see annex).", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Methodology", file = variable.name , sep = "\n", append = TRUE)
      cat("The aim of predictive modelisation is to make a link between the variable that is to be predicted and a set of predictive variables called predictors. The original sample is divided into two datasets. A training one is used to build each model and a testing one is used to validate them The best model is chosen according to the accuracy of the prediction, that is, the proportion of predicted modalities that fit actual ones, using the testing dataset.", file = variable.name , sep = "\n", append = TRUE)
      cat("For example, if the hypothesis is that households with a higher number of children below 5, headed by a single female, who arrived in the country of asylum in 2012, are more likely to resort to child marriage. The training dataset tells us this is true for 80 percent of cases where a child has been married off. We then move to the testing dataset, to see if this is true for a similar percentage of cases.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r decision tree,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("##decision tree", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_model <- rpart(as.factor(train_Y) ~  ., data = train,", file = variable.name , sep = "\n", append = TRUE)
      cat("                   method=\"class\",control=rpart.control(minsplit=2, minbucket=1, cp=0.0005))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_model.predict <- predict(rpart_model, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_model.predict <- as.data.frame(rpart_model.predict)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Building final prediction as being the category with the highest probability", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_predict <- c(0)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for(i in 1:nrow(rpart_model.predict)){", file = variable.name , sep = "\n", append = TRUE)
      cat("  rpart_predict[i] <- colnames(rpart_model.predict[i,])[which(rpart_model.predict[i,] == max(rpart_model.predict[i,]), arr.ind = TRUE)[2]]", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####ajouter titres aux raph", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:rpart\", unload = TRUE) ", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r random forest, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#install.packages(\"randomForest\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.model <- randomForest(as.factor(train_Y) ~ . , data = train)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#plot(rf.model)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.model.predict <- predict(rf.model, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf_model.predict <- as.matrix(predict(rf.model, test))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf_predict <- as.vector(rf_model.predict)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Building final prediction as being the category with the highest probability", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r MLR, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(nnet)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:caret\", unload= TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("# Building the model", file = variable.name , sep = "\n", append = TRUE)
      cat("train2 <- train[, sapply(train, function(col) nlevels(unique(col))) < 10] #for MLR to work", file = variable.name , sep = "\n", append = TRUE)
      cat("test2 <- subset(test, select = colnames(train2))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("try(MLR_model <- multinom(train_Y ~., data = train2))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the probabilities of being in each category using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("try(MLR_predict <- predict(MLR_model2, test2))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:nnet\", unload= TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r LDA, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("###Linear discriminant analysis", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho <- train_dicho[!sapply(train_dicho, function(.col){ ", file = variable.name , sep = "\n", append = TRUE)
      cat("     all(is.na(.col))  || all(.col[1L] == .col) ", file = variable.name , sep = "\n", append = TRUE)
      cat(" }) ] ", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lda_model <- lda(train_Y~  ., data = train_dicho )", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho$FSRec <- test$FSRec", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lda_model.predict <- predict(lda_model, test_dicho)$posterior", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lda_model.predict <- as.data.frame(lda_model.predict)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Building final prediction as being the category with the highest probability", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lda_predict <- c(0)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for(i in 1:nrow(lda_model.predict)){", file = variable.name , sep = "\n", append = TRUE)
      cat("  lda_predict[i] <- colnames(lda_model.predict[i,])[which(lda_model.predict[i,] == max(lda_model.predict[i,]), arr.ind = TRUE)[2]]", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Selecting the best model for predictions", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#### Accuracy", file = variable.name , sep = "\n", append = TRUE)
      cat("The indicator of the quality of prediction used in this section is the accuracy, that is the proportion of observations in the testing dataset that have the same predicted and actual modalities, considering the predicted outcome. The higher the accuracy the better the model.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r accuracy, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Building an indicator of the quality of prediction using the proportion of similarities between predicted and actual", file = variable.name , sep = "\n", append = TRUE)
      cat("#testing values", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("accuracy <- function(prediction){", file = variable.name , sep = "\n", append = TRUE)
      cat("  criterion <- 0", file = variable.name , sep = "\n", append = TRUE)
      cat("  for(i in 1:length(test_Y)){", file = variable.name , sep = "\n", append = TRUE)
      cat("    if(test_Y[i] == prediction[i]){", file = variable.name , sep = "\n", append = TRUE)
      cat("      criterion <- criterion + 1", file = variable.name , sep = "\n", append = TRUE)
      cat("    }", file = variable.name , sep = "\n", append = TRUE)
      cat("  }", file = variable.name , sep = "\n", append = TRUE)
      cat("  Accuracy <- criterion/length(test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Calculating the criterion for each model", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("accuracy_lda <- accuracy(lda_predict)", file = variable.name , sep = "\n", append = TRUE)
      cat("accuracy_tree <- accuracy(rpart_predict)", file = variable.name , sep = "\n", append = TRUE)
      cat("accuracy_MLR <- 0", file = variable.name , sep = "\n", append = TRUE)
      cat("try(accuracy_MLR <- accuracy(MLR_predict))", file = variable.name , sep = "\n", append = TRUE)
      cat("accuracy_rf <- accuracy(rf_predict)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r clasiffy models with a table,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("accuracies <- c(accuracy_lda, accuracy_MLR, accuracy_rf, accuracy_tree)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("sorting <- data.frame(acc = accuracies,models = c(\"LDA\",\"MLR\",\"RF\",\"TREE\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("sorting <- sorting[order(sorting[,1],decreasing = TRUE),]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#### Building predictions", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("Once the best model is chosen  due to its high accuracy, it can be applied to the whole registration dataset.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r prediction on proGres data,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("##The prediction is done on the ProGres data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred <- progrescase", file = variable.name , sep = "\n", append = TRUE)
      cat("pred <- as.data.frame(lapply(pred, as.factor))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- pred", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Only the variables which used for training the model are kept (with the same levels)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- subset(pred2, select = colnames(train))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:ncol(pred2)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2[,i] <-  factor(as.character(pred2[,i]), levels = levels(train[,i]))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Imputation of missing data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(VIM)", file = variable.name , sep = "\n", append = TRUE)
      cat("# pred <- hotdeck(pred,imp_var = FALSE)  #basic imputation method", file = variable.name , sep = "\n", append = TRUE)
      cat("# anyNA(pred)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("while(anyNA(pred2) == TRUE){", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2 <- hotdeck(pred2,imp_var = FALSE)  #basic imputation method", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:VIM\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.pred <- nrow(pred)", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.pred2 <- nrow(pred2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r building prediction, echo=FALSE, warning=FALSE, cache=FALSE, tidy = TRUE, message=FALSE, comment = \"\", fig.height=3, size=\"small\"}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#MLR", file = variable.name , sep = "\n", append = TRUE)
      cat("if(accuracy_MLR==max(accuracies)){", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- subset(pred2, select = colnames(train2))", file = variable.name , sep = "\n", append = TRUE)
      cat("    for (i in 1:ncol(pred2)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2[,i] <-  factor(as.character(pred2[,i]), levels = levels(train2[,i]))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(MLR_model2, newdata = pred2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#tree", file = variable.name , sep = "\n", append = TRUE)
      cat("if(accuracy_tree==max(accuracies)){", file = variable.name , sep = "\n", append = TRUE)
      cat("  ", file = variable.name , sep = "\n", append = TRUE)
      cat("fitted.results.var <- predict(rpart_model, newdata = pred2)", file = variable.name , sep = "\n", append = TRUE)
      cat("fitted.results.var <- as.data.frame(fitted.results.var)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- c(0)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("  for(i in 1:nrow(fitted.results.var)){", file = variable.name , sep = "\n", append = TRUE)
      cat("    pred2$fitted.results.var[i] <- colnames(fitted.results.var[i,])[which(fitted.results.var[i,] == max(fitted.results.var[i,]), arr.ind = TRUE)[2]]", file = variable.name , sep = "\n", append = TRUE)
      cat("  }", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- as.factor(pred2$fitted.results.var)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#lda", file = variable.name , sep = "\n", append = TRUE)
      cat("if(accuracy_lda==max(accuracies)){", file = variable.name , sep = "\n", append = TRUE)
      cat("  ", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("fitted.results.var <- predict(lda_model, newdata = as.data.frame(c(acm.disjonctif(pred2[sapply(pred2, is.factor)]), pred2[sapply(pred2, is.numeric)])) )$posterior", file = variable.name , sep = "\n", append = TRUE)
      cat("fitted.results.var <- as.data.frame(fitted.results.var)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:ade4\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- c(0)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("  for(i in 1:nrow(fitted.results.var)){", file = variable.name , sep = "\n", append = TRUE)
      cat("    pred2$fitted.results.var[i] <- colnames(fitted.results.var[i,])[which(fitted.results.var[i,] ==  max(fitted.results.var[i,]), arr.ind = TRUE)[2]]", file = variable.name , sep = "\n", append = TRUE)
      cat("  }", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- as.factor(pred2$fitted.results.var)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#rf", file = variable.name , sep = "\n", append = TRUE)
      cat("if(accuracy_rf==max(accuracies)){", file = variable.name , sep = "\n", append = TRUE)
      cat("  ", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- as.factor(predict(rf.model, newdata = pred2))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Repartition of the predicted outcome among the population", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r repartition of the predicted outcome among the population, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("pred$fitted.results.var <- pred2$fitted.results.var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("table <- as.data.frame(prop.table(table(pred$fitted.results.var )))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Format table", file = variable.name , sep = "\n", append = TRUE)
      cat("table$Freq <- paste0(round(table$Freq*100, digits = 1),\"%\")", file = variable.name , sep = "\n", append = TRUE)
      cat("table <- table[ ,c(\"Var1\",\"Freq\" )]", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table)[1] <- \"Outcome\"", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table)[2] <- \"Frequency\"", file = variable.name , sep = "\n", append = TRUE)
      cat("ggplot(data = table, aes(x = table$Outcome, y = table$Frequency)) +", file = variable.name , sep = "\n", append = TRUE)
      cat("geom_bar(color = \"white\",fill = \"#2a87c8\",stat = \"identity\",width=0.3) +", file = variable.name , sep = "\n", append = TRUE)
      cat("labs(x = \"\", y = \"Frequency\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("ggtitle(\"Repartition of the predicted outcome among the population\")+", file = variable.name , sep = "\n", append = TRUE)
      cat("theme(plot.title = element_text(face = \"bold\", size = 9), plot.background = element_rect(fill = \"transparent\",colour = NA))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Repartition of the predicted outcome in each location of asylum", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r Repartition of the outcome in each location of asylum, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("if(length(subset(pred, select= location )[,1]) != 0){", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("table2 <- as.data.frame(prop.table(table(subset(pred, select= location)[,1], pred$fitted.results.var )))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("percent <- function(x, digits = 0, format = \"f\", ...) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  paste0(formatC( x, format = format, digits = digits, ...), \"%\")", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Format table", file = variable.name , sep = "\n", append = TRUE)
      cat("#table2$Freq <- paste0(round(table2$Freq*100,digits = 1),\"%\")", file = variable.name , sep = "\n", append = TRUE)
      cat("                      ", file = variable.name , sep = "\n", append = TRUE)
      cat("table2 <- table2[ ,c(\"Var1\", \"Var2\", \"Freq\" )]", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table2)[1] <- \"Location\"", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table2)[2] <- \"Outcome\"", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table2)[3] <- \"Frequency\"", file = variable.name , sep = "\n", append = TRUE)
      cat("ggplot(data = table2, aes(x = Location, y = Frequency*100, fill = Outcome)) +", file = variable.name , sep = "\n", append = TRUE)
      cat("geom_bar(color = \"white\", stat = \"identity\", width=0.5) +", file = variable.name , sep = "\n", append = TRUE)
      cat("labs(x = \"\", y = \"Frequency\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("ggtitle(\"Repartition of the predicted outcome in each location of asylum\")+", file = variable.name , sep = "\n", append = TRUE)
      cat("theme(plot.title = element_text(face = \"bold\", size = 9), plot.background = element_rect(fill = \"transparent\",colour = NA)) + scale_fill_discrete(limits=levels(pred2$fitted.results.var)) + scale_y_continuous(labels = percent)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Annex: Statistical results", file = variable.name , sep = "\n", append = TRUE)
      cat("###Variable selection with Random Forests", file = variable.name , sep = "\n", append = TRUE)
      cat("The algorithm choses the 10 most relevant variables according to their importance (Mean Decrease Gini):", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r selection graph, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("#Plot of most important variables", file = variable.name , sep = "\n", append = TRUE)
      cat("varImpPlot(rf.modelselect,", file = variable.name , sep = "\n", append = TRUE)
      cat("           sort = T,", file = variable.name , sep = "\n", append = TRUE)
      cat("           main=\"Variable Importance\",", file = variable.name , sep = "\n", append = TRUE)
      cat("           n.var=10)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Decision tree", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("A decision tree is an algorithm that builds a tree like graph to illustrate the possible outcomes of an event or question, here referred to as a decision. To build the tree, the algorithm first finds the predictive variable that does the best task of separating the data into two groups. Then, it repeats the above step with the other variables. This results in a tree graph, where each split represents a decision. The algorithm chooses the splits such that the maximum number of observations are classified correctly.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r tree graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot tree ", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rpart_model, uniform=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("text(rpart_model, use.n=TRUE, all=TRUE, cex=.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:rpart\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Random Forest ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("In Random Forests the idea is to generate several decision trees using different samples randomly chosen from training data. The next step is to simply reduce the variance in the trees by averaging them. Averaging the trees reduces the variance and also improves the performance of decision trees on test datasets and eventually avoids overfitting (a dependency of the model on the training set so strong, it can be considered biased).", file = variable.name , sep = "\n", append = TRUE)
      cat("The following graph shows the veolution of the error rate according to the number of trees, for each category.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r rf graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rf.model)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Multinomial logistic regression", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("Multinomial logistic regression is used to model categorical outcome variables, based on the observations. It allows us to predict the probability that each category has to happen, based on a logistic function. Then the category with the highest probability is chosen to build the prediction.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r mlr graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# library(nnet)", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# try(ggcoef(MLR_model2, exponentiate = TRUE,conf.int=TRUE))", file = variable.name , sep = "\n", append = TRUE)
      cat("# detach(\"package:nnet\", unload= TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Linear Discriminant Analysis (LDA)", file = variable.name , sep = "\n", append = TRUE)
      cat("Discriminant analysis is another segmentation method. It segments groups in a way as to achieve maximum separation between them. This technique makes use of the information provided by the predictive variables to achieve the clearest possible separation between the two groups of the binary outcome. Points belonging to the same class should be close together, while also being far away from the other clusters. Statistical properties (mean and variance os the variable of interest in each class) are estimated from the data and plugged into the LDA equation to make predictions. LDA can be used instead of Logistic Regression to improve stability when there are few examples from which to estimate the parameters or when classes are well separated.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Building predictions", file = variable.name , sep = "\n", append = TRUE)
      cat("This table shows the classification of models according to their accuracy of prediction.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r clasiffy print,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("print(sorting)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)

    }

    ## Binary outcome #####

    if(selected.predictVars[i] %in% dico[ which(dico$fullname == selected.predictVars[i]  & dico$listname %in% c("yesno", "yesnono","yes_no") ), ]$fullname){

      cat("---", file = variable.name , sep = "\n", append = TRUE)
      cat("title: \"Prediction report\"", file = variable.name , sep = "\n", append = TRUE)
      cat("author: \"(Binary outcome)\"", file = variable.name , sep = "\n", append = TRUE)
      cat("date: \" `r format(Sys.Date(),  '%d %B %Y')`\"", file = variable.name , sep = "\n", append = TRUE)
      cat("output:", file = variable.name , sep = "\n", append = TRUE)
      cat("  word_document:", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_caption: yes", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_height: 5", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_width: 8", file = variable.name , sep = "\n", append = TRUE)
      cat("    reference_docx: style-unhcr-portrait.docx", file = variable.name , sep = "\n", append = TRUE)
      cat("    #toc: yes", file = variable.name , sep = "\n", append = TRUE)
      cat("    #toc_depth: 2", file = variable.name , sep = "\n", append = TRUE)
      cat("---", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r setup, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat(" mainDir <- getwd()", file = variable.name , sep = "\n", append = TRUE)
      cat(" mainDirroot <- substring(mainDir, 0 , nchar(mainDir) - 5)", file = variable.name , sep = "\n", append = TRUE)
      cat(" ## Load all required packages", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(MASS)", file = variable.name , sep = "\n", append = TRUE)
      cat("### Library ########", file = variable.name , sep = "\n", append = TRUE)
      cat("# load packages", file = variable.name , sep = "\n", append = TRUE)
      cat(" #library(RGtk2)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"ggplot2\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"corrplot\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"ROCR\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"caret\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"questionr\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(effects)", file = variable.name , sep = "\n", append = TRUE)
      cat("#need to change the path to your Java location in order to find the jvm.dll file", file = variable.name , sep = "\n", append = TRUE)
      cat(" #install.packages(\"rJava\")", file = variable.name , sep = "\n", append = TRUE)
      cat("# library(rJava)", file = variable.name , sep = "\n", append = TRUE)
      cat("# library(glmulti)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(xgboost)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(caret)", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat("#detaching useless packages ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"MASS\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"GGally\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"xtable\")", file = variable.name , sep = "\n", append = TRUE)
      cat("# install.packages(\"sdcMicro\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(readxl)", file = variable.name , sep = "\n", append = TRUE)
      cat(" library(koboloadeR)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ROCR)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(haven)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(memisc)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(pander)", file = variable.name , sep = "\n", append = TRUE)
      cat("# install.packages(\"rpart\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(rpart.plot)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(RColorBrewer)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(rattle)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(classInt)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Initializing the training dataset fo building the model", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- surveypro", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Isolating the variable of interest", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- subset(train, select = variablesname)[,1]", file = variable.name , sep = "\n", append = TRUE)
      cat("#The predictive variables will be the ones from ProGres", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[,-which(names(train) == variablesname)]", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- subset(train, select= colnames(progrescase))", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- as.data.frame(lapply(train, as.factor))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Remove variables will too many levels or constant", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[, sapply(train, function(col) nlevels(unique(col))) < 50] #for random forest to work", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[, sapply(train, function(col) nlevels(unique(col))) > 1] #for random forest to work", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#The variable of interest is transformed into 0 1 binary variable ", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- as.character(var)", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- factor(var, levels=c(\"0\",\"1\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- as.numeric(as.character(var))", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Imputation of missing data in the variable of interest with k nearest neighbors", file = variable.name , sep = "\n", append = TRUE)
      cat("library(VIM)", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- kNN(train,  \"var\",  imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Saving the variable ", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- train$var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r variable selection, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Basic imputation method for the rest of the data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("while(anyNA(train) == TRUE){", file = variable.name , sep = "\n", append = TRUE)
      cat("  train <- hotdeck(train, imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Random Forests are used to perform variable selection", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train_Y <- as.factor(train$var)", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.modelselect <- randomForest(train_Y ~ . , data = train)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance <- as.data.frame(rf.modelselect$importance)", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance$label <- rownames(rf.importance)", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance <-(rf.importance[with(rf.importance, order(-MeanDecreaseGini)),])", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("selectedVars <- rf.importance$label[1:10]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#The 10 most relevant variables are selected", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- subset(train, select = selectedVars)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r creating datasets, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Creating dichotomized training and testing samples", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho <- as.data.frame(c(acm.disjonctif(train[,sapply(train, is.factor)]), train[sapply(train, is.numeric)]))", file = variable.name , sep = "\n", append = TRUE)
      cat(" detach(\"package:ade4\", unload = TRUE)  ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create data for training and test ########", file = variable.name , sep = "\n", append = TRUE)
      cat("set.seed(0)", file = variable.name , sep = "\n", append = TRUE)
      cat("tr.number <- sample(nrow(train_dicho),nrow(train_dicho)*2/3)", file = variable.name , sep = "\n", append = TRUE)
      cat("# we split whole dataset into 2/3 training data and 1/3 testing data", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho <- train_dicho[-tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho <- train_dicho[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# split dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("train_Y = as.numeric(train_dicho$var)", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("test_Y = test_dicho$var", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("column_names = names(test_dicho)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# numericize training and testing data", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho[] <- lapply(train_dicho, as.numeric)", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho[] <- lapply(test_dicho, as.numeric)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Creating non dichotomized training and testing samples", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Removing constant variables", file = variable.name , sep = "\n", append = TRUE)
      cat("try(train <- train[!sapply(train, function(.col){ ", file = variable.name , sep = "\n", append = TRUE)
      cat("     all(is.na(.col))  || all(.col[1L] == .col) ", file = variable.name , sep = "\n", append = TRUE)
      cat(" }) ]) ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#train<-train4", file = variable.name , sep = "\n", append = TRUE)
      cat("test <- train[-tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("#train<-train[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("test$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.train <- nrow(train)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Introduction", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The purpose of this section of the package is to build predictions of the variables of interest using the registration data. In practice, this means operations can predict which households are more likely to possess a certain characteristic, based on certain things those households might have in common. So, for example, if the Child Protection Unit wants to identify households at risk of child marriage for an intervention. The package takes the variable child marriage and looks at all the households where this issue exists, and finds what those households have in common. When a sample is representative, the findings, in this case, the model, can be extrapolated", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Data description", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat(" The variables used for prediction are taken from the registration data:  education, origin, place of asylum, occupation, family profile, case size, female ratio,", file = variable.name , sep = "\n", append = TRUE)
      cat("dependency, marital status and year of arrival in the country of asylum. The dataset gathers ",nrow(survey)," individuals", file = variable.name , sep = "\n", append = TRUE)
      cat("This variable is present in the household survey dataset, while the variables used for prediction are taken from the registration data (or proGres database). A statistical model called a random forest model was used to select the registration variables which most closely correlate to " ,variablesname, "(see annex).", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Methodology", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The aim of predictive modelisation is to make a link between the variable that is to be predicted and a set of predictive variables called predictors. ", file = variable.name , sep = "\n", append = TRUE)
      cat("The original sample is divided into two datasets. A training one is used to build each model and a testing one is used to validate them. For example, if the hypothesis is that households with a higher number of children below 5, headed by a single female, who arrived in the country of asylum in 2012, are more likely to resort to child marriage. The training dataset tells us this is true for 80 percent of cases where a child has been married off. We then move to the testing dataset, to see if this is true for a similar percentage of cases.", file = variable.name , sep = "\n", append = TRUE)
      cat("Area Under the ROC Curve (AUC) is the criterion usedd to draw a comparison between models according to their predictive capacity. An AUC equal to 1 means that the model perfectly predicts the variable of interest while a 0.5 AUC indicates that the model has no predictive capacity at all.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The analysis will meet two key concepts:", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("   ", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat(" *  __Exclusion__: % of \"false negative\", i.e. the individuals who have a predicted indicator equal to 0 while the actual value is 1", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat(" *  __Inclusion__: % of \"false positive\", i.e. the individuals who have a predicted indicator equal to 1 while the actual value is 0", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r xgboost model,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Construct xgb.DMatrix object from training matrix", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("dtrain <- xgb.DMatrix(as.matrix(train_dicho), label=train_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a list of parameters for XGBoost model", file = variable.name , sep = "\n", append = TRUE)
      cat("param <- list(max_depth = 3,", file = variable.name , sep = "\n", append = TRUE)
      cat("              silent = 1,", file = variable.name , sep = "\n", append = TRUE)
      cat("              eta = 0.3,", file = variable.name , sep = "\n", append = TRUE)
      cat("              objective = 'binary:logistic',", file = variable.name , sep = "\n", append = TRUE)
      cat("              eval_metric = 'auc')", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Training a XGBoost model using training dataset and chosen parameters", file = variable.name , sep = "\n", append = TRUE)
      cat("bst <- xgb.train(param,", file = variable.name , sep = "\n", append = TRUE)
      cat("                 nrounds = 82,", file = variable.name , sep = "\n", append = TRUE)
      cat("                 dtrain)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("pred.xgb <- predict(bst, as.matrix(test_dicho))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a table indicating the most important features of XGBoost model", file = variable.name , sep = "\n", append = TRUE)
      cat("importance <- xgb.importance(feature_names = column_names, model = bst)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# A great advantage of using XGBoost model is its built-in ability to show us a feature importance table.", file = variable.name , sep = "\n", append = TRUE)
      cat("# The importance metric provides a score indicating how valuable each factor was in the construction of the boosted decision trees.", file = variable.name , sep = "\n", append = TRUE)
      cat("# Higher relative importance indicates a larger impact on the algorithm and final prediction.", file = variable.name , sep = "\n", append = TRUE)
      cat("# visualize the top 10 important features in histogram usingmetric.", file = variable.name , sep = "\n", append = TRUE)
      cat("xgb.plot.importance(importance_matrix = importance, top_n = 10)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a prediction object using previously saved results", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_xgb <- prediction(pred.xgb, test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r confusion matrix,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("# Confusion Matrix #################", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#  1. Obtain the auc, fpr,tpr and accuracy using prediction function", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#  2. Define get_cutoff_point function to obtain the cutoff probability given a fixed fpr.", file = variable.name , sep = "\n", append = TRUE)
      cat("# Any predicted probability that is greater than the cutoff will be classified as attrition and vise versa.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# 3. Define draw_confusion_matrix function to draw a confusion matrix plot given", file = variable.name , sep = "\n", append = TRUE)
      cat("# calculated confusion table, auc and chosen color.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Define a function to obtain the cutoff probability ####", file = variable.name , sep = "\n", append = TRUE)
      cat("# @perf is a S4 object gotten from @performance function", file = variable.name , sep = "\n", append = TRUE)
      cat("# @threshold is the targeted fpr", file = variable.name , sep = "\n", append = TRUE)
      cat("# In the ShinyApp, users can adjust the threshold by themselves and", file = variable.name , sep = "\n", append = TRUE)
      cat("# obtain different confusion matrix accordingly. Here, we always set", file = variable.name , sep = "\n", append = TRUE)
      cat("# threshold = 0.5 just for illustration.", file = variable.name , sep = "\n", append = TRUE)
      cat("get_cutoff_point <- function(perf, threshold)", file = variable.name , sep = "\n", append = TRUE)
      cat("{", file = variable.name , sep = "\n", append = TRUE)
      cat("  cutoffs <- data.frame(cut = perf@alpha.values[[1]], fpr = perf@x.values[[1]], tpr = perf@y.values[[1]])", file = variable.name , sep = "\n", append = TRUE)
      cat("  cutoffs <- cutoffs[order(cutoffs$tpr, decreasing = TRUE),]", file = variable.name , sep = "\n", append = TRUE)
      cat("  cutoffs <- subset(cutoffs, fpr <= threshold)", file = variable.name , sep = "\n", append = TRUE)
      cat("  if (nrow(cutoffs) == 0) { return(1.0)}", file = variable.name , sep = "\n", append = TRUE)
      cat("  else return(cutoffs[1, 1])", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Define a function to draw a confusion matrix plot #####", file = variable.name , sep = "\n", append = TRUE)
      cat("# @cm is a confusion matrix obtained from @confusionMatrix function", file = variable.name , sep = "\n", append = TRUE)
      cat("# @auc is the auc value obtained from @performance function", file = variable.name , sep = "\n", append = TRUE)
      cat("# @color is the kind of color you want for true positive and true negative areas", file = variable.name , sep = "\n", append = TRUE)
      cat("# In this function, we also add in accuracy information which calculates the", file = variable.name , sep = "\n", append = TRUE)
      cat("# overall performance of model", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix <- function(cm, auc, color) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  layout(matrix(c(1,1,2)))", file = variable.name , sep = "\n", append = TRUE)
      cat("  par(mar = c(0,0.1,1,0.1))", file = variable.name , sep = "\n", append = TRUE)
      cat("  plot(c(125, 345), c(300, 450), type = \"n\", xlab = \"\", ylab = \"\", xaxt = 'n', yaxt = 'n')", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("  # create the matrix", file = variable.name , sep = "\n", append = TRUE)
      cat("  rect(150, 430, 240, 370, col = color)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(195, 435, '0', cex = 1.2)", file = variable.name , sep = "\n", append = TRUE)
      cat("  rect(250, 430, 340, 370, col = 'white')", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(295, 435, '1', cex = 1.2)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(125, 370, 'Predicted', cex = 1.3, srt = 90, font = 2)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(245, 450, 'Actual', cex = 1.3, font = 2)", file = variable.name , sep = "\n", append = TRUE)
      cat("  rect(150, 305, 240, 365, col = 'white')", file = variable.name , sep = "\n", append = TRUE)
      cat("  rect(250, 305, 340, 365, col = color)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(140, 400, '0', cex = 1.2, srt = 90)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(140, 335, '1', cex = 1.2, srt = 90)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("  # add in the cm results", file = variable.name , sep = "\n", append = TRUE)
      cat("  res <- as.numeric(cm$table)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(195, 400, res[1], cex = 1.6, font = 2, col = 'white')", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(195, 335, res[2], cex = 1.6, font = 2, col = 'black')", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(295, 400, res[3], cex = 1.6, font = 2, col = 'black')", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(295, 335, res[4], cex = 1.6, font = 2, col = 'white')", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("  # add in the specifics", file = variable.name , sep = "\n", append = TRUE)
      cat("  plot(c(0, 100), c(0, 50), type = \"n\", xlab = \"\", ylab = \"\", main = \"\", xaxt = 'n', yaxt = 'n')", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("  # add in the accuracy information", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(25, 30, \"AUC\", cex = 1.8, font = 2)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(25, 20, round(as.numeric(auc), 3), cex = 1.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(75, 30, names(cm$overall[1]), cex = 1.8, font = 2)", file = variable.name , sep = "\n", append = TRUE)
      cat("  text(75, 20, round(as.numeric(cm$overall[1]), 3), cex = 1.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# draw XGBoosting confusion matrix #####", file = variable.name , sep = "\n", append = TRUE)
      cat("#obtain auc from @performance", file = variable.name , sep = "\n", append = TRUE)
      cat("auc_xgb <- performance(ROCRpred_xgb, measure = \"auc\")", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_xgb <- performance(ROCRpred_xgb, 'tpr','fpr')  #obtain tpr and fpr from @performance", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_xgb, 0.5) #obtain the cutoff probability", file = variable.name , sep = "\n", append = TRUE)
      cat("pred_values_xgb <- ifelse(pred.xgb > cut,1,0) #classify using cutoff probability", file = variable.name , sep = "\n", append = TRUE)
      cat("cm_xgb <- confusionMatrix(data = as.factor(pred_values_xgb), reference = as.factor(test_Y)) #obtain confusion matrix", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_xgb, auc_xgb@y.values, \"#3DB7E4\")  #Draw confusion matrix plot", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:xgboost\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:VIM\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r decision tree,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("##decision tree", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_model <- rpart(train_Y ~  ., data = train,", file = variable.name , sep = "\n", append = TRUE)
      cat("                   method=\"anova\",control=rpart.control(minsplit=2, minbucket=1, cp=0.005,maxsplit = 3))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot tree ", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rpart_model, uniform=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("text(rpart_model, use.n=TRUE, all=TRUE, cex=.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_model.predict <- predict(rpart_model, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a prediction object using previously saved results", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_tree <- prediction(rpart_model.predict, test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# draw Logistic regression confusion matrix #####", file = variable.name , sep = "\n", append = TRUE)
      cat("auc_tree <- performance(ROCRpred_tree, measure = \"auc\")", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_tree <- performance(ROCRpred_tree, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_tree, 0.5)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred_values_tree <- ifelse(rpart_model.predict > 0.5,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#max(pred_values_tree)", file = variable.name , sep = "\n", append = TRUE)
      cat("cm_tree <- confusionMatrix(data = as.factor(pred_values_tree), reference = as.factor(test_Y))", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_tree, auc_tree@y.values, \"#69BE28\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:rpart\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r random forest, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.model <- randomForest(train_Y ~ . , data = train)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#plot(rf.model)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.model.predict <- predict(rf.model, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rf.model, type=\"l\", main=\"Error rates the Random forest model\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a prediction object using previously saved results", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_rf <- prediction(rf.model.predict, test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("varImpPlot(rf.model,", file = variable.name , sep = "\n", append = TRUE)
      cat("           sort = T,", file = variable.name , sep = "\n", append = TRUE)
      cat("           main=\"Variable Importance\",", file = variable.name , sep = "\n", append = TRUE)
      cat("           n.var=5)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r random forest matrix, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("# Confusion Matrix #################", file = variable.name , sep = "\n", append = TRUE)
      cat("# draw RF confusion matrix #####", file = variable.name , sep = "\n", append = TRUE)
      cat("auc_rf <- performance(ROCRpred_rf, measure = \"auc\")", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_rf <- performance(ROCRpred_rf, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_rf, 0.5)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred_values_rf <- ifelse(rf.model.predict > cut,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("cm_rf <- confusionMatrix(data = as.factor(pred_values_rf), reference = as.factor(test_Y))", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_rf, auc_rf@y.values, \"#FF8849\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r SVM model,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho$var <- train_Y", file = variable.name , sep = "\n", append = TRUE)
      cat("#train_dicho<-hotdeck(train_dicho, imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Training a SVM", file = variable.name , sep = "\n", append = TRUE)
      cat("library(e1071)", file = variable.name , sep = "\n", append = TRUE)
      cat("svm_model <- svm(var ~.,               # set model formula", file = variable.name , sep = "\n", append = TRUE)
      cat("               type = \"C-classification\",   # set classification machine", file = variable.name , sep = "\n", append = TRUE)
      cat("               gamma = 0.001668101,         # set gamma parameter", file = variable.name , sep = "\n", append = TRUE)
      cat("               cost = 35.93814,             # set cost parameter", file = variable.name , sep = "\n", append = TRUE)
      cat("               data = train_dicho,", file = variable.name , sep = "\n", append = TRUE)
      cat("               cross = 3,                   #3-fold cross validation", file = variable.name , sep = "\n", append = TRUE)
      cat("               probability = TRUE        #allow for probability prediction", file = variable.name , sep = "\n", append = TRUE)
      cat("              )", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("# Obtain the predicted class 0/1", file = variable.name , sep = "\n", append = TRUE)
      cat("svm_model.predict <- predict(svm_model, test_dicho, probability = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("# Obtain the predicted probability for class 0/1", file = variable.name , sep = "\n", append = TRUE)
      cat("svm_model.prob <- attr(svm_model.predict,\"probabilities\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#plot(svm_model.predict, data=train_dicho, col = \"blue\", ylab=\"Predicted outcome\", width=0.1 , size=0.2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:e1071\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a prediction object using previously saved results", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_svm <- prediction(1-svm_model.prob[,2], test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Confusion Matrix #################", file = variable.name , sep = "\n", append = TRUE)
      cat("# draw SVM confusion matrix #####", file = variable.name , sep = "\n", append = TRUE)
      cat("auc_svm <- performance(ROCRpred_svm, measure = \"auc\")", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_svm <- performance(ROCRpred_svm, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_svm, 0.5)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred_values_svm <- ifelse(svm_model.prob[,2] > cut,0,1)", file = variable.name , sep = "\n", append = TRUE)
      cat("cm_svm <- confusionMatrix(data = as.factor(pred_values_svm), reference = as.factor(test_Y))", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_svm, auc_svm@y.values, \"#FF8849\")", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r LR model,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("## Logistic regression model ######", file = variable.name , sep = "\n", append = TRUE)
      cat("# uses a logit link from the data matrix to the class probability.", file = variable.name , sep = "\n", append = TRUE)
      cat("# The logit function always generates a predicted value between 0 and 1 that can be interpreted as  a probability.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Training a logistic regression model", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# for (i in 1:(length(train)-1)) {train[,i] <- droplevels(train[,i])}", file = variable.name , sep = "\n", append = TRUE)
      cat("# for (i in 1:(length(train)-1)){test[,i] <- factor(test[,i], levels = levels(train[,i]))}", file = variable.name , sep = "\n", append = TRUE)
      cat("LR_model <- glm(train_Y ~  .,", file = variable.name , sep = "\n", append = TRUE)
      cat("                   family = binomial(link = 'logit'), data = train)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Review model best on parcymony", file = variable.name , sep = "\n", append = TRUE)
      cat("LR_model2<-LR_model", file = variable.name , sep = "\n", append = TRUE)
      cat("try(LR_model2 <- stepAIC(LR_model2))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## The testing data should have the same variables and levels after the stepAIC", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("testo <- test", file = variable.name , sep = "\n", append = TRUE)
      cat("if(length(names(LR_model2$xlevels)) == 0){", file = variable.name , sep = "\n", append = TRUE)
      cat("  testo <- subset(testo, select = names(LR_model$xlevels))", file = variable.name , sep = "\n", append = TRUE)
      cat("  for (i in 1:ncol(testo)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  testo[,i] <-  factor(as.character(testo[,i]), levels = LR_model$xlevels[[i]])", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("LR_model.predict <- predict(LR_model, testo, type = \"response\")", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(length(names(LR_model2$xlevels)) != 0){", file = variable.name , sep = "\n", append = TRUE)
      cat("  testo <- subset(testo, select = names(LR_model2$xlevels))", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:ncol(testo)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  testo[,i] <-  factor(as.character(testo[,i]), levels = LR_model2$xlevels[[i]])", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("LR_model.predict <- predict(LR_model2, testo, type = \"response\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot(LR_model2)", file = variable.name , sep = "\n", append = TRUE)
      cat("# summary(LR_model2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r LR model 4,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("# draw Logistic regression confusion matrix #####", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_lr <- prediction(LR_model.predict, test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("auc_lr <- performance(ROCRpred_lr, measure = \"auc\")", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_lr <- performance(ROCRpred_lr, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_lr, 0.5)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred_values_lr <- ifelse(LR_model.predict > cut,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("cm_lr <- confusionMatrix(data = as.factor(pred_values_lr), reference = as.factor(test_Y))", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_lr, auc_lr@y.values, \"#69BE28\")", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r LDA, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("###Linear discriminant analysis", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho <- train_dicho[!sapply(train_dicho, function(.col){ ", file = variable.name , sep = "\n", append = TRUE)
      cat("     all(is.na(.col))  || all(.col[1L] == .col) ", file = variable.name , sep = "\n", append = TRUE)
      cat(" }) ] ", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lda_model <- lda(train_Y~  ., data = train_dicho )", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lda_model.predict <- predict(lda_model, test_dicho,probability=TRUE)$posterior[,2]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a prediction object using previously saved results", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_lda <- prediction(lda_model.predict, test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# draw Logistic regression confusion matrix #####", file = variable.name , sep = "\n", append = TRUE)
      cat("auc_lda <- performance(ROCRpred_lda, measure = \"auc\")", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_lda <- performance(ROCRpred_lda, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_lda, 0.5)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred_values_lda <- ifelse(lda_model.predict > 0.5,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#max(pred_values_lda)", file = variable.name , sep = "\n", append = TRUE)
      cat("cm_lda <- confusionMatrix(data = as.factor(pred_values_lda), reference = as.factor(test_Y))", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_lda, auc_lda@y.values, \"#69BE28\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot(lda_model, ", file = variable.name , sep = "\n", append = TRUE)
      cat("#      panel = function(x, y, ...) {", file = variable.name , sep = "\n", append = TRUE)
      cat("#        points(x, y, ...)", file = variable.name , sep = "\n", append = TRUE)
      cat("#        text(x,y,labels=seq_along(x),...) ## You change labels here ", file = variable.name , sep = "\n", append = TRUE)
      cat("#       }", file = variable.name , sep = "\n", append = TRUE)
      cat("#       , col = as.integer(train$var), pch = 20)", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot(pred_values_lda, type=\"n\", ylab=c(\"LDA Axis 1\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# ", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot(lda_model, points=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## To build predictions, the chosen model is the one with the highest AUC", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r clasiffy models with a table,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("AUCs <- c(as.numeric(auc_lda@y.values), as.numeric(auc_lr@y.values), as.numeric(auc_svm@y.values), as.numeric(auc_tree@y.values), as.numeric(auc_xgb@y.values), as.numeric(auc_rf@y.values))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("sorting <- data.frame(auc = AUCs,models = c(\"LDA\",\"LR\",\"SVM\",\"TREE\",\"XGBoost\",\"RF\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("sorting <- sorting[order(sorting[,1],decreasing = TRUE),]", file = variable.name , sep = "\n", append = TRUE)
      cat("print(sorting)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r prediction on proGres data,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("##The prediction is done on the ProGres data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred <- progrescase", file = variable.name , sep = "\n", append = TRUE)
      cat("pred <- as.data.frame(lapply(pred, as.factor))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- pred", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Only the variables which used for training the model are kept (with the same levels)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- subset(pred2, select = colnames(train))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:ncol(pred2)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2[,i] <-  factor(as.character(pred2[,i]), levels = levels(train[,i]))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Imputation of missing data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(VIM)", file = variable.name , sep = "\n", append = TRUE)
      cat("# pred <- hotdeck(pred,imp_var = FALSE)  #basic imputation method", file = variable.name , sep = "\n", append = TRUE)
      cat("# anyNA(pred)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("while(anyNA(pred2) == TRUE){", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2 <- hotdeck(pred2,imp_var = FALSE)  #basic imputation method", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:VIM\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.pred <- nrow(pred)", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.pred2 <- nrow(pred2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#### Building predictions", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r building prediction, echo=FALSE, warning=FALSE, cache=FALSE, tidy = TRUE, message=FALSE, comment = \"\", fig.height=3, size=\"small\"}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("if(as.numeric(auc_svm@y.values)==max(AUCs)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#svm", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(svm_model, newdata = as.data.frame(c(acm.disjonctif(pred2[sapply(pred2, is.factor)]), pred2[sapply(pred2, is.numeric)])) , type ='response')", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:ade4\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(as.numeric(auc_xgb@y.values)==max(AUCs)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#xgboost", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(bst, as.matrix(as.data.frame(c(acm.disjonctif(pred2[sapply(pred2, is.factor)]), pred2[sapply(pred2, is.numeric)]))))", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_xgb, 0.5)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- ifelse(pred2$fitted.results.var > cut,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:ade4\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(as.numeric(auc_lr@y.values)==max(AUCs)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#LR", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("predo <- pred2", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- subset(pred2, select = names(LR_model2$xlevels))", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:ncol(pred2)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2[,i] <-  factor(as.character(pred2[,i]), levels = LR_model2$xlevels[[i]])", file = variable.name , sep = "\n", append = TRUE)
      cat("}  ", file = variable.name , sep = "\n", append = TRUE)
      cat("  ", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(LR_model2, newdata = pred2, type='response')", file = variable.name , sep = "\n", append = TRUE)
      cat("cut <- get_cutoff_point(perf_lr, 0.5)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- ifelse(pred2$fitted.results.var > cut,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(as.numeric(auc_tree@y.values)==max(AUCs)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#tree", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(rpart_model, newdata = pred2 , type = c(\"vector\", \"prob\", \"class\", \"matrix\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- ifelse(pred2$fitted.results.var > 0.5,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(as.numeric(auc_lda@y.values)==max(AUCs)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#lda", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(lda_model, newdata = as.data.frame(c(acm.disjonctif(pred2[sapply(pred2, is.factor)]), pred2[sapply(pred2, is.numeric)])))$posterior[,2]", file = variable.name , sep = "\n", append = TRUE)
      cat("#cut <- get_cutoff_point(perf_lda, 0.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- ifelse(pred2$fitted.results.var > 0.5,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:ade4\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(as.numeric(auc_rf@y.values)==max(AUCs)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#rf", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(rf.model, newdata = pred2)", file = variable.name , sep = "\n", append = TRUE)
      cat("#cut <- get_cutoff_point(perf_lda, 0.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- ifelse(pred2$fitted.results.var > 0.5,1,0)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Repartition of the predicted outcome among the population", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r repartition of the predicted indicator, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("table <- as.data.frame(prop.table(table(pred2$fitted.results.var )))", file = variable.name , sep = "\n", append = TRUE)
      cat("## Format table", file = variable.name , sep = "\n", append = TRUE)
      cat("table$Freq <- paste0(round(table$Freq*100,digits = 1),\"%\")", file = variable.name , sep = "\n", append = TRUE)
      cat("table <- table[ ,c(\"Var1\",\"Freq\" )]", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table)[1] <- \"Indicator\"", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table)[2] <- \"Frequency\"", file = variable.name , sep = "\n", append = TRUE)
      cat("ggplot(data = table, aes(x = table$Indicator, y = table$Frequency)) +", file = variable.name , sep = "\n", append = TRUE)
      cat("geom_bar(color = \"white\",fill = \"#2a87c8\",stat = \"identity\",width=0.3) +", file = variable.name , sep = "\n", append = TRUE)
      cat("labs(x = \"\", y = \"Frequency\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("ggtitle(\"Repartition of the predicted indicator among the population\")+", file = variable.name , sep = "\n", append = TRUE)
      cat("theme(plot.title = element_text(face = \"bold\", size = 9), plot.background = element_rect(fill = \"transparent\",colour = NA))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Origin of the predicted outcome ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      # cat("```{r origin  of the positive predicted indicator, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      # cat("pred$fitted.results.var <- pred2$fitted.results.var", file = variable.name , sep = "\n", append = TRUE)
      # cat("positive <- subset(pred, pred$fitted.results.var==1)", file = variable.name , sep = "\n", append = TRUE)
      # cat("#if(length(subset(positive, select= origin )[,1]) != 0){", file = variable.name , sep = "\n", append = TRUE)
      # cat("table3 <- as.data.frame(prop.table(table(subset(positive, select= origin )[,1])))", file = variable.name , sep = "\n", append = TRUE)
      # cat("## Format table", file = variable.name , sep = "\n", append = TRUE)
      # cat("table3 <- table3[ ,c(\"Var1\",\"Freq\" )]", file = variable.name , sep = "\n", append = TRUE)
      # cat("names(table3)[1] <- \"Origin\"", file = variable.name , sep = "\n", append = TRUE)
      # cat("names(table3)[2] <- \"Frequency\"", file = variable.name , sep = "\n", append = TRUE)
      # cat("ggplot(data = table3, aes(x = table3$Origin, y = table3$Frequency)) +", file = variable.name , sep = "\n", append = TRUE)
      # cat("geom_bar(color = \"white\",fill = \"#2a87c8\",stat = \"identity\",width=0.5,position=position_dodge()) +", file = variable.name , sep = "\n", append = TRUE)
      # cat("labs(x = \"Origin\", y = \"Frequency\") +", file = variable.name , sep = "\n", append = TRUE)
      # cat("geom_text(aes(label=percent(paste0(round(table3$Frequency*100,digits = 1)))), vjust=-0.3, size=3.5)+", file = variable.name , sep = "\n", append = TRUE)
      # cat("ggtitle(\"Origin of the refugees with positive indicator\")+coord_cartesian(ylim = c(0, 0.6))+", file = variable.name , sep = "\n", append = TRUE)
      # cat("        theme(plot.title = element_text(face = \"bold\", size = 9), plot.background = element_rect(fill = \"transparent\",colour = NA))", file = variable.name , sep = "\n", append = TRUE)
      # cat("#}", file = variable.name , sep = "\n", append = TRUE)
      #cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r origin 2 of the positive predicted indicator, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("pred$fitted.results.var <- pred2$fitted.results.var", file = variable.name , sep = "\n", append = TRUE)
      cat("positive <- subset(pred, pred$fitted.results.var==1)", file = variable.name , sep = "\n", append = TRUE)

      cat("if(length(subset(positive, select= origin )[,1]) != 0){", file = variable.name , sep = "\n", append = TRUE)
      cat("table3 <- as.data.frame(prop.table(table(subset(positive, select= origin )[,1])))", file = variable.name , sep = "\n", append = TRUE)
      cat("## Format table", file = variable.name , sep = "\n", append = TRUE)
      cat("table3 <- subset(table3, Freq > 0.01)", file = variable.name , sep = "\n", append = TRUE)
      cat("table3 <- table3[ ,c(\"Var1\",\"Freq\" )]", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table3)[1] <- \"Origin\"", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table3)[2] <- \"Frequency\"", file = variable.name , sep = "\n", append = TRUE)
      cat("ggplot(data = table3, aes(x = table3$Origin, y = table3$Frequency)) +", file = variable.name , sep = "\n", append = TRUE)
      cat("geom_bar(color = \"white\",fill = \"#2a87c8\",stat = \"identity\",width=0.5,position=position_dodge()) +", file = variable.name , sep = "\n", append = TRUE)
      cat("labs(x = \"Origin\", y = \"Frequency\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("geom_text(aes(label=percent(paste0(round(table3$Frequency*100,digits = 1)))), vjust=-0.3, size=3.5)+", file = variable.name , sep = "\n", append = TRUE)
      cat("ggtitle(\"Origin of the refugees with positive indicator\")+coord_cartesian(ylim = c(0, 1))+", file = variable.name , sep = "\n", append = TRUE)
      cat("        theme(plot.title = element_text(face = \"bold\", size = 9), plot.background = element_rect(fill = \"transparent\",colour = NA))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Location of the predicted outcome ", file = variable.name , sep = "\n", append = TRUE)

      cat("```{r location of the positive predicted indicator, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)

      cat("if(length(subset(positive, select= location )[,1]) != 0){", file = variable.name , sep = "\n", append = TRUE)
      cat("table2 <- as.data.frame(prop.table(table(subset(positive, select= location )[,1])))", file = variable.name , sep = "\n", append = TRUE)
      cat("## Format table", file = variable.name , sep = "\n", append = TRUE)
      cat("table2 <- subset(table2, Freq > 0.01)", file = variable.name , sep = "\n", append = TRUE)
      cat("table2 <- table2[ ,c(\"Var1\",\"Freq\" )]", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table2)[1] <- \"Location\"", file = variable.name , sep = "\n", append = TRUE)
      cat("names(table2)[2] <- \"Frequency\"", file = variable.name , sep = "\n", append = TRUE)
      cat("ggplot(data = table2, aes(x = table2$Location, y = table2$Frequency)) +", file = variable.name , sep = "\n", append = TRUE)
      cat("geom_bar(color = \"white\",fill = \"#2a87c8\",stat = \"identity\",width=0.5,position=position_dodge()) +", file = variable.name , sep = "\n", append = TRUE)
      cat("labs(x = \"Location\", y = \"Frequency\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("geom_text(aes(label=percent(paste0(round(table2$Frequency*100,digits = 1)))), vjust=-0.3, size=3.5)+", file = variable.name , sep = "\n", append = TRUE)
      cat("ggtitle(\"Location of asylum of the refugees with positive indicator\")+coord_cartesian(ylim = c(0, 1))+", file = variable.name , sep = "\n", append = TRUE)
      cat("        theme(plot.title = element_text(face = \"bold\", size = 9), plot.background = element_rect(fill = \"transparent\",colour = NA))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Annex: Statistical results", file = variable.name , sep = "\n", append = TRUE)
      cat("###Variable selection with Random Forests", file = variable.name , sep = "\n", append = TRUE)
      cat("The algorithm choses the 10 most relevant variables according to their importance (Mean Decrease Gini):", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r selection graph, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("#Plot of most important variables", file = variable.name , sep = "\n", append = TRUE)
      cat("varImpPlot(rf.modelselect,", file = variable.name , sep = "\n", append = TRUE)
      cat("           sort = T,", file = variable.name , sep = "\n", append = TRUE)
      cat("           main=\"Variable Importance\",", file = variable.name , sep = "\n", append = TRUE)
      cat("           n.var=10)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Extreme Gradient Boosting (XGBoost)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("Boosting is an ensemble of techniques where predictors are made sequentially. Subsequent predictors learn from the mistakes of the previous ones. Gradient boosting involves three elements:", file = variable.name , sep = "\n", append = TRUE)
      cat("-A loss function to be optimized (here AUC).", file = variable.name , sep = "\n", append = TRUE)
      cat("-A weak learner to make predictions (generally decision trees).", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The following chart shows which modalities of the predictive variables contribute the most to the prediction.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The confusion matrix reports the number of false positives (the individuals who have a predicted indicator equal to 1 while the actual value is 0), false negatives, true positives, and true negatives after the prediction.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r xgboost graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(xgboost)", file = variable.name , sep = "\n", append = TRUE)
      cat("# visualize the top 10 important features in histogram usingmetric.", file = variable.name , sep = "\n", append = TRUE)
      cat("xgb.plot.importance(importance_matrix = importance, top_n = 10)", file = variable.name , sep = "\n", append = TRUE)
      cat("#confusion matrix", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_xgb, auc_xgb@y.values, \"#3DB7E4\")  #Draw confusion matrix plot", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Decision tree", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("A decision tree is an algorithm that builds a tree-like graph to illustrate the possible outcomes of an event or question, here referred to as a decision. To build the tree, the algorithm first finds the predictive variable that does the best task of separating the data into two groups. Then, it repeats the above step with the other variables. This results in a tree graph, where each split represents a decision. The algorithm chooses the splits such that the maximum number of observations are classified correctly.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r tree graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot tree ", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rpart_model, uniform=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("text(rpart_model, use.n=TRUE, all=TRUE, cex=.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:rpart\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("#confusion matrix", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_tree, auc_tree@y.values, \"#69BE28\")  #Draw confusion matrix plot", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Random Forest ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("In Random Forests the idea is to generate several decision trees using different samples randomly chosen from training data. The next step is to simply reduce the variance in the trees by averaging them. Averaging the trees reduces the variance and also improves the performance of decision trees on test datasets and eventually avoids overfitting (a dependency of the model on the training set so strong, it can be considered biased). ", file = variable.name , sep = "\n", append = TRUE)
      cat("The following graph shows the eveolution of the error rate according to the number of trees, for each category.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r rf graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rf.model)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_rf, auc_rf@y.values, \"#FF8849\")", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Support Vector Machine (SVM) model", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("Support Vector Machines are one of the best ways to classify binary outcomes. A SVM algorithm creates a decision boundary such that most points in the first category fall on one side of the boundary while most points in the", file = variable.name , sep = "\n", append = TRUE)
      cat("second category fall on the other side.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r svm graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_svm, auc_svm@y.values, \"#FF8849\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Linear Discriminant Analysis (LDA)", file = variable.name , sep = "\n", append = TRUE)
      cat("Discriminant analysis is another segmentation method. It segments groups in a way as to achieve maximum separation between them. This technique makes use of the information provided by the predictive variables to achieve the clearest possible separation between the two groups of the binary outcome. Points belonging to the same class should be close together, while also being far away from the other clusters. Statistical properties (mean and variance os the variable of interest in each class) are estimated from the data and plugged into the LDA equation to make predictions. LDA can be used instead of Logistic Regression to improve stability when there are few examples from which to estimate the parameters or when classes are well separated.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r lda graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_lda, auc_lda@y.values, \"#69BE28\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Logistic Regression (LR) model", file = variable.name , sep = "\n", append = TRUE)
      cat("The goal of LR is to evaluate the probability of a discrete outcome occurring, based on the observations. Logistic Regression allows us to compute this probability based on a logistic function. A decision boundary is then used to pass from probabilities to classification.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The following chart shows the values of the coefficients and their associated 95% confidence intervals (horizontal bars). A coefficient equal to 0.5 means that the individuals who have this characteristics are 0.5 times more likely to be in the positive category of the variable we want to predict.", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r lr graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("draw_confusion_matrix(cm_lr, auc_lr@y.values, \"#69BE28\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Selecting the model", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#### ROC curves", file = variable.name , sep = "\n", append = TRUE)
      cat("A Receiver Operating Characteristic (ROC) curve is a graphical plot that illustrates the diagnostic ability of a binary classifier system as its discrimination threshold is varied. It is created by plotting the true positive rate  against the false positive rate at various threshold settings. In case of a binary outcome (equal to 0 or 1), an outcome is false positive (or false alarm) if the predicted value is 1 while the actual value is 0.", file = variable.name , sep = "\n", append = TRUE)
      cat("Therefore the closer the ROC curve is to the upper left corner, the better the classifier.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r ROC curves, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("# Receiver Operating Characteristic (ROC) curve #####", file = variable.name , sep = "\n", append = TRUE)
      cat("# result of plotting the true positive rate against the false positive rate.", file = variable.name , sep = "\n", append = TRUE)
      cat("# The closer the ROC curve is to the top left corner, the greater the accuracy of the test.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create a prediction object using previously saved results", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_xgb <- prediction(pred.xgb, test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_svm <- prediction(svm_model.prob[,2], test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("ROCRpred_lr <- prediction(LR_model.predict, test_Y)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#XGBoost roc data", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_xgb <- performance(ROCRpred_xgb, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("roc_xgb.data <- data.frame(fpr = unlist(perf_xgb@x.values),", file = variable.name , sep = "\n", append = TRUE)
      cat("                           tpr = unlist(perf_xgb@y.values), model = \"XGBoost\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#SVM roc data", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_svm <- performance(ROCRpred_svm, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("roc_svm.data <- data.frame(fpr = unlist(perf_svm@x.values),", file = variable.name , sep = "\n", append = TRUE)
      cat("                           tpr = unlist(perf_svm@y.values), model = \"SVM\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Logistic Regression roc data", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_lr <- performance(ROCRpred_lr, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("roc_lr.data <- data.frame(fpr = unlist(perf_lr@x.values),", file = variable.name , sep = "\n", append = TRUE)
      cat("                          tpr = unlist(perf_lr@y.values), model = \"LR\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Decision Tree Regression roc data", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_tree <- performance(ROCRpred_tree, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("roc_tree.data <- data.frame(fpr = unlist(perf_tree@x.values),", file = variable.name , sep = "\n", append = TRUE)
      cat("                          tpr = unlist(perf_tree@y.values), model = \"TREE\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Linear Discriminant Analysis roc data", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_lda <- performance(ROCRpred_lda, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("roc_lda.data <- data.frame(fpr = unlist(perf_lda@x.values),", file = variable.name , sep = "\n", append = TRUE)
      cat("                          tpr = unlist(perf_lda@y.values), model = \"LDA\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Random Forest roc data", file = variable.name , sep = "\n", append = TRUE)
      cat("perf_rf <- performance(ROCRpred_rf, 'tpr','fpr')", file = variable.name , sep = "\n", append = TRUE)
      cat("roc_rf.data <- data.frame(fpr = unlist(perf_rf@x.values),", file = variable.name , sep = "\n", append = TRUE)
      cat("                          tpr = unlist(perf_rf@y.values), model = \"LDA\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Define colors for roc plot", file = variable.name , sep = "\n", append = TRUE)
      cat("cols <- c(\"XGBoost\" = \"#3DB7E4\",", file = variable.name , sep = "\n", append = TRUE)
      cat("          \"SVM\" = \"#FF8849\",", file = variable.name , sep = "\n", append = TRUE)
      cat("          \"LR\" = \"#EFD242\",", file = variable.name , sep = "\n", append = TRUE)
      cat("          \"TREE\" = \"#FF0000\",", file = variable.name , sep = "\n", append = TRUE)
      cat("          \"LDA\" = \"#000000\",", file = variable.name , sep = "\n", append = TRUE)
      cat("          \"RF\"=\"#009900\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create roc plot", file = variable.name , sep = "\n", append = TRUE)
      cat("ggplot() +", file = variable.name , sep = "\n", append = TRUE)
      cat("  geom_line(data = roc_xgb.data, aes(x = fpr, y = tpr, colour = \"XGBoost\")) + #set XGBoost roc curve", file = variable.name , sep = "\n", append = TRUE)
      cat("  geom_line(data = roc_svm.data, aes(x = fpr, y = tpr, colour = \"SVM\")) + #set SVM roc curve", file = variable.name , sep = "\n", append = TRUE)
      cat("  geom_line(data = roc_lr.data, aes(x = fpr, y = tpr, colour = \"LR\")) +", file = variable.name , sep = "\n", append = TRUE)
      cat("  #set LR roc curve", file = variable.name , sep = "\n", append = TRUE)
      cat("  geom_line(data = roc_tree.data, aes(x = fpr, y = tpr, colour = \"TREE\")) + #set TREE roc curve", file = variable.name , sep = "\n", append = TRUE)
      cat("  geom_line(data = roc_lda.data, aes(x = fpr, y = tpr, colour = \"LDA\")) + #set LDA roc curve", file = variable.name , sep = "\n", append = TRUE)
      cat("  geom_line(data = roc_rf.data, aes(x = fpr, y = tpr, colour = \"RF\")) + #set RF roc curve", file = variable.name , sep = "\n", append = TRUE)
      cat("  geom_vline(xintercept = 0.5, color = \"red\", linetype = 2) +", file = variable.name , sep = "\n", append = TRUE)
      cat("  theme_bw() + #set themes", file = variable.name , sep = "\n", append = TRUE)
      cat("  scale_colour_manual(name = \"Models\", values = cols) +", file = variable.name , sep = "\n", append = TRUE)
      cat("  xlab(\"False Positive Rate\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("  ylab(\"True Positive Rate\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("  theme(legend.position = c(0.8, 0.2),", file = variable.name , sep = "\n", append = TRUE)
      cat("        legend.text = element_text(size = 15),", file = variable.name , sep = "\n", append = TRUE)
      cat("        legend.title = element_text(size = 15))", file = variable.name , sep = "\n", append = TRUE)
      cat("#rpart", file = variable.name , sep = "\n", append = TRUE)
      cat("#regression linear discriminant", file = variable.name , sep = "\n", append = TRUE)
      cat("#liste variables a predire pour faire tourner l'algo + donnees", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("This table shows the classification of models according to their accuracy of prediction.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r clasiffy print,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("print(sorting)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)



    }

    ## Continuous outcome #####

    if(selected.predictVars[i] %in% dico[ which(dico$fullname == selected.predictVars[i] & dico$type == "integer" & dico$type != "select_one"), ]$fullname){

      cat("---", file = variable.name , sep = "\n", append = TRUE)
      cat("title: \"Prediction report\"", file = variable.name , sep = "\n", append = TRUE)
      cat("author: \"(Continous outcome)\"", file = variable.name , sep = "\n", append = TRUE)
      cat("date: \" `r format(Sys.Date(),  '%d %B %Y')`\"", file = variable.name , sep = "\n", append = TRUE)
      cat("output:", file = variable.name , sep = "\n", append = TRUE)
      cat("  word_document:", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_caption: yes", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_height: 5", file = variable.name , sep = "\n", append = TRUE)
      cat("    fig_width: 8", file = variable.name , sep = "\n", append = TRUE)
      cat("    reference_docx: style-unhcr-portrait.docx", file = variable.name , sep = "\n", append = TRUE)
      cat("    #toc: yes", file = variable.name , sep = "\n", append = TRUE)
      cat("    #toc_depth: 2", file = variable.name , sep = "\n", append = TRUE)
      cat("---", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r setup, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat(" mainDir <- getwd()", file = variable.name , sep = "\n", append = TRUE)
      cat(" mainDirroot <- substring(mainDir, 0 , nchar(mainDir) - 5)", file = variable.name , sep = "\n", append = TRUE)
      cat(" ## Load all required packages", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(MASS)", file = variable.name , sep = "\n", append = TRUE)
      cat("### Library ########", file = variable.name , sep = "\n", append = TRUE)
      cat("# load packages", file = variable.name , sep = "\n", append = TRUE)
      cat(" #library(RGtk2)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"ggplot2\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"corrplot\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"ROCR\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"caret\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"questionr\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(effects)", file = variable.name , sep = "\n", append = TRUE)
      cat("#need to change the path to your Java location in order to find the jvm.dll file", file = variable.name , sep = "\n", append = TRUE)
      cat(" #install.packages(\"rJava\")", file = variable.name , sep = "\n", append = TRUE)
      cat("# library(rJava)", file = variable.name , sep = "\n", append = TRUE)
      cat("# library(glmulti)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(pls)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(xgboost)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(nnet)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(caret)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(glmnet)", file = variable.name , sep = "\n", append = TRUE)
      cat(" ", file = variable.name , sep = "\n", append = TRUE)
      cat("#detaching useless packages ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:pls\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:nnet\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:glmnet\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# install.packages(\"e1071\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"e1071\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Logistic regression is a simple classifier used to estimate the probability of a binary outcome based on several predictors and a logit function.", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(\"MASS\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"GGally\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(\"xtable\")", file = variable.name , sep = "\n", append = TRUE)
      cat("# install.packages(\"sdcMicro\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(readxl)", file = variable.name , sep = "\n", append = TRUE)
      cat(" library(koboloadeR)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ROCR)", file = variable.name , sep = "\n", append = TRUE)
      cat("library(haven)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(memisc)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(pander)", file = variable.name , sep = "\n", append = TRUE)
      cat("# install.packages(\"rpart\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(rpart.plot)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(RColorBrewer)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(rattle)", file = variable.name , sep = "\n", append = TRUE)
      cat("#library(classInt)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Provide below the name of the form in xsl form - format should be xls not xlsx", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- surveypro", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Isolating the variable of interest", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- subset(train, select = variablesname)[,1]", file = variable.name , sep = "\n", append = TRUE)
      cat("#The predictive variables will be the ones from ProGres", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[,-which(names(train) == variablesname)]", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- subset(train, select= colnames(progrescase))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- as.data.frame(lapply(train, as.factor))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Remove variables will too many levels or constant", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[, sapply(train, function(col) nlevels(unique(col))) < 50] #for random forest to work", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[, sapply(train, function(col) nlevels(unique(col))) > 1] #for random forest to work", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#var <- as.vector((subset(train, select = selected.predictVars))[,1])", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- as.numeric(var)", file = variable.name , sep = "\n", append = TRUE)

      cat("train$var <- var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Imputation of missing data in the variable of interest with k nearest neighbors", file = variable.name , sep = "\n", append = TRUE)
      cat("library(VIM)", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- kNN(train,  \"var\",  imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:length(train$var)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("if(train$var[i] == 0){", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var[i] <- mean(train$var)", file = variable.name , sep = "\n", append = TRUE)
      cat("}}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Saving the variable ", file = variable.name , sep = "\n", append = TRUE)
      cat("var <- train$var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r variable selection, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Basic imputation method for the rest of the data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("while(anyNA(train) == TRUE){", file = variable.name , sep = "\n", append = TRUE)
      cat("  train <- hotdeck(train, imp_var = FALSE)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Random Forests are used to perform variable selection", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train_Y <- train$var", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.modelselect <- randomForest(train_Y ~ . , data = train)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance <- as.data.frame(rf.modelselect$importance)", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance$label <- rownames(rf.importance)", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.importance <-(rf.importance[with(rf.importance, order(-IncNodePurity)),])", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("selectedVars <- rf.importance$label[1:10]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#The 10 most relevant variables are selected", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- subset(train, select = selectedVars)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r creating datasets, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- var", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Creating dichotomized training and testing samples", file = variable.name , sep = "\n", append = TRUE)
      cat("library(ade4)", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho <- as.data.frame(c(acm.disjonctif(train[,sapply(train, is.factor)]), train[sapply(train, is.numeric)]))", file = variable.name , sep = "\n", append = TRUE)
      cat(" detach(\"package:ade4\", unload = TRUE)  ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Create data for training and test ########", file = variable.name , sep = "\n", append = TRUE)
      cat("set.seed(0)", file = variable.name , sep = "\n", append = TRUE)
      cat("tr.number <- sample(nrow(train_dicho),nrow(train_dicho)*2/3)", file = variable.name , sep = "\n", append = TRUE)
      cat("# we split whole dataset into 2/3 training data and 1/3 testing data", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho <- train_dicho[-tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho <- train_dicho[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# split dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("train_Y = as.numeric(train_dicho$var)", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("test_Y = test_dicho$var", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("column_names = names(test_dicho)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# numericize training and testing data", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho[] <- lapply(train_dicho, as.numeric)", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho[] <- lapply(test_dicho, as.numeric)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Creating non dichotomized training and testing samples", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Removing constant variables", file = variable.name , sep = "\n", append = TRUE)
      cat("try(train <- train[!sapply(train, function(.col){ ", file = variable.name , sep = "\n", append = TRUE)
      cat("     all(is.na(.col))  || all(.col[1L] == .col) ", file = variable.name , sep = "\n", append = TRUE)
      cat(" }) ]) ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#train<-train4", file = variable.name , sep = "\n", append = TRUE)
      cat("test <- train[-tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("train <- train[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("#train<-train[tr.number,]", file = variable.name , sep = "\n", append = TRUE)
      cat("test$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.train <- nrow(train)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Introduction", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The purpose of this section of the package is to build predictions of the variables of interest using the registration data. In practice, this means operations can predict which households are more likely to possess a certain characteristic, based on certain things those households might have in common. So, for example, if the Child Protection Unit wants to identify households at risk of child marriage for an intervention. The package takes the variable child marriage and looks at all the households where this issue exists, and finds what those households have in common. When a sample is representative, the findings, in this case, the model, can be extrapolated.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Data description", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The variable that is to be predicted is " ,variablesname, ".", file = variable.name , sep = "\n", append = TRUE)

      cat(" The variables used for prediction are taken from the registration data:  education, origin, place of asylum, occupation, family profile, case size, female ratio,", file = variable.name , sep = "\n", append = TRUE)
      cat("dependency, marital status and year of arrival in the country of asylum. The dataset gathers ",nrow(survey)," individuals", file = variable.name , sep = "\n", append = TRUE)
      cat("The variable to be predicted is present in the household survey dataset, while the variables used for prediction are taken from the registration data (or proGres database). A statistical model called a random forest model was used to select the registration variables which most closely correlate to " ,variablesname, "(see annex).", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Methodology", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The aim of predictive modelisation is to make a link between the variable that is to be predicted and a set of predictive variables called predictors. The original sample is divided into two datasets. A training one is used to build each model and a testing one is used to validate them. Correlation between predicted and actual values (from the testing dataset) is the criterion used to draw a comparison between the models according to their predictive capacity. The higher the correlation the better the prediction. For example, if the hypothesis is that households with a higher number of children below 5, headed by a single female, who arrived in the country of asylum in 2012, are more likely to resort to child marriage. The training dataset tells us this is true for 80 percent of cases where a child has been married off. We then move to the testing dataset, to see if this is true for a similar percentage of cases.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r lm,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Removing constant variables", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("LM <- lm(var ~ ., data=train)", file = variable.name , sep = "\n", append = TRUE)
      cat("#summary(LM)", file = variable.name , sep = "\n", append = TRUE)
      cat("LM2 <- stepAIC(LM, steps = 5)", file = variable.name , sep = "\n", append = TRUE)
      cat("#summary(LM2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("testo <- test", file = variable.name , sep = "\n", append = TRUE)
      cat("testo <- subset(testo, select = names(LM2$xlevels))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:ncol(testo)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("testo[,i] <-  factor(as.character(testo[,i]), levels = LM2$xlevels[[i]])", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lm.predict <- predict(LM2, testo)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Compute the correlation between predicted and actual values", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("actuals_preds_LM <- data.frame(cbind(actuals=test_Y, predicteds=lm.predict))  # make actuals_predicted dataframe.", file = variable.name , sep = "\n", append = TRUE)
      cat("correlation_accuracy_LM <- abs(cor(actuals_preds_LM)[3])  # 50.17%", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Shapiro-Wilk test of residuals normality (Normal QQplot)", file = variable.name , sep = "\n", append = TRUE)
      cat("#Homoscedasticity (residuals vs fitted)", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(LM2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r glm,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("GLM <- glm(var ~ ., data=train, family = Gamma)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#summary(GLM)", file = variable.name , sep = "\n", append = TRUE)
      cat("try(GLM2 <- step(GLM, steps = 5))", file = variable.name , sep = "\n", append = TRUE)
      cat("#summary(GLM2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("testo <- test", file = variable.name , sep = "\n", append = TRUE)
      cat("testo <- subset(testo, select = names(LM2$xlevels))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:ncol(testo)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("testo[,i] <-  factor(as.character(testo[,i]), levels = LM2$xlevels[[i]])", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("glm.predict <- predict(GLM, testo)", file = variable.name , sep = "\n", append = TRUE)
      cat("try(glm.predict <- predict(GLM2, test))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Compute the correlation between predicted and actual values", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("actuals_preds_GLM <- data.frame(cbind(actuals=test_Y, predicteds=glm.predict) ) # make actuals_predicteds dataframe.", file = variable.name , sep = "\n", append = TRUE)
      cat("correlation_accuracy_GLM <- abs(cor(actuals_preds_GLM)[2])  # 5.17%", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Shapiro-Wilk test of residuals normality (Normal QQplot)", file = variable.name , sep = "\n", append = TRUE)
      cat("#Homoscedasticity (residuals vs fitted)", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(GLM)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r pls, include = FALSE,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#test$FSRec<-NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("library(pls)", file = variable.name , sep = "\n", append = TRUE)
      cat("plsFit = plsr(train_Y ~ ., data=train, validation=\"CV\")", file = variable.name , sep = "\n", append = TRUE)
      cat("pls.pred = predict(plsFit, test, ncomp=1:2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#root mean squared error of prediction (RMSEP)", file = variable.name , sep = "\n", append = TRUE)
      cat("validationplot(plsFit, val.type=\"RMSEP\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pls.eval=data.frame(obs=test_Y, pred=pls.pred[,1,1])", file = variable.name , sep = "\n", append = TRUE)
      cat("defaultSummary(pls.eval)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("##", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pls.predict <- predict(plsFit, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Compute the correlation between predicted and actual values", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("actuals_preds_pls <- data.frame(cbind(actuals=test_Y, predicteds=pls.predict))  # make actuals_predicteds dataframe.", file = variable.name , sep = "\n", append = TRUE)
      cat("correlation_accuracy_pls <- abs(cor(actuals_preds_pls)[3])  ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r lasso,  include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho$FSRec<-NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#install.packages(\"glmnet\")", file = variable.name , sep = "\n", append = TRUE)
      cat("library(glmnet)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train_dicho$var<-NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("test_dicho$var<-NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lasso <-glmnet(as.matrix(train_dicho), train_Y, alpha = 1) ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lasso.predict <- predict(lasso, as.matrix(test_dicho))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Compute the correlation between predicted and actual values", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("actuals_preds_lasso <- data.frame(cbind(actuals=test_Y, predicteds=lasso.predict))  # make actuals_predicteds dataframe.", file = variable.name , sep = "\n", append = TRUE)
      cat("correlation_accuracy_lasso <- abs(cor(actuals_preds_lasso)[3])  ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(lasso, xvar = \"lambda\")", file = variable.name , sep = "\n", append = TRUE)
      cat("#coef(lasso, s = 0.0001) # s is the value of lambda", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r log,  echo = FALSE, include = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("LMlog <- lm(log(train_Y) ~ ., data=train)", file = variable.name , sep = "\n", append = TRUE)
      cat("#summary(LM)", file = variable.name , sep = "\n", append = TRUE)
      cat("LMlog2 <- stepAIC(LMlog)", file = variable.name , sep = "\n", append = TRUE)
      cat("#summary(LMlog2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("lmlog.predict <- predict(LMlog2, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Compute the correlation between predicted and actual values", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("actuals_preds_LMlog <- data.frame(cbind(actuals=log(test_Y), predicteds=lmlog.predict))  # make actuals_predicteds dataframe.", file = variable.name , sep = "\n", append = TRUE)
      cat("correlation_accuracy_log <- abs(cor(actuals_preds_LMlog)[3])  ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#Shapiro-Wilk test of residuals normality (Normal QQplot)", file = variable.name , sep = "\n", append = TRUE)
      cat("#Homoscedasticity (residuals vs fitted)", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(LMlog)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r decision tree,  include= FALSE,echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("##decision tree", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("train$var <- NULL", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_model <- rpart(train_Y ~  ., data = train,", file = variable.name , sep = "\n", append = TRUE)
      cat("                   method=\"anova\",control=rpart.control(minsplit=2, minbucket=1, cp=0.0005))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot tree ", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rpart_model)", file = variable.name , sep = "\n", append = TRUE)
      cat("text(rpart_model, use.n=TRUE, all=TRUE, cex=.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# Predicting the results using testing dataset", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rpart_model.predict <- predict(rpart_model, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Compute the correlation between predicted and actual values", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("actuals_preds_tree <- data.frame(cbind(actuals=log(test_Y), predicteds=rpart_model.predict))# make actuals_predicteds dataframe.", file = variable.name , sep = "\n", append = TRUE)
      cat("correlation_accuracy_tree <- abs(cor(actuals_preds_tree)[3])  ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r random forest, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("#install.packages(\"randomForest\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.model <- randomForest(train_Y ~ . , data = train)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rf.model, type = \"l\")", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("rf.model.predict <- predict(rf.model, test)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("actuals_preds_rf <- data.frame(cbind(actuals=test_Y, predicteds=rf.model.predict))  # make actuals_predicteds dataframe.", file = variable.name , sep = "\n", append = TRUE)
      cat("correlation_accuracy_rf <- abs(cor(actuals_preds_rf)[3])  ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Selecting the best model for predictions", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("To select the model with the best predictive capacity, the criterion used is the correlation between predictions and actual values taken from the testing dataset. The model with the highest correlation is chosen.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r clasiffy models with a table, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("corr <- c(correlation_accuracy_LM, correlation_accuracy_GLM, correlation_accuracy_lasso, correlation_accuracy_pls,", file = variable.name , sep = "\n", append = TRUE)
      cat("          correlation_accuracy_log, correlation_accuracy_tree, correlation_accuracy_rf)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("sorting<-data.frame(corr = corr,models = c(\"LM\",\"GLM\",\"lasso\",\"pls\",\"log\",\"tree\",\"rf\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("sorting <- sorting[order(sorting[,1],decreasing = TRUE),]", file = variable.name , sep = "\n", append = TRUE)
      cat("print(as.data.frame(sorting), order = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Building predictions", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r prediction on proGres data,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("##The prediction is done on the ProGres data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred <- progrescase", file = variable.name , sep = "\n", append = TRUE)
      cat("pred <- as.data.frame(lapply(pred, as.factor))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- pred", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Only the variables which used for training the model are kept (with the same levels)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2 <- subset(pred2, select = colnames(train))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("for (i in 1:ncol(pred2)) {", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2[,i] <-  factor(as.character(pred2[,i]), levels = levels(train[,i]))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Imputation of missing data", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(VIM)", file = variable.name , sep = "\n", append = TRUE)
      cat("# pred <- hotdeck(pred,imp_var = FALSE)  #basic imputation method", file = variable.name , sep = "\n", append = TRUE)
      cat("# anyNA(pred)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("while(anyNA(pred2) == TRUE){", file = variable.name , sep = "\n", append = TRUE)
      cat("  pred2 <- hotdeck(pred2,imp_var = FALSE)  #basic imputation method", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:VIM\", unload = TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.pred <- nrow(pred)", file = variable.name , sep = "\n", append = TRUE)
      cat("nrow.pred2 <- nrow(pred2)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r building prediction, echo=FALSE, warning=FALSE, cache=FALSE, tidy = TRUE, message=FALSE, comment = \"\", fig.height=3, size=\"small\"}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("if(correlation_accuracy_LM==max(corr)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#LM", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(LM2, newdata = pred2 , type ='response')", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(correlation_accuracy_GLM==max(corr)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#GLM", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(GLM2, newdata = pred2 , type ='response')", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(correlation_accuracy_lasso==max(corr)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#Lasso", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(lasso, as.matrix(pred2_dicho) )[1]", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(correlation_accuracy_pls==max(corr)){", file = variable.name , sep = "\n", append = TRUE)
      cat("#pls", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(plsFit, pred2)", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(correlation_accuracy_log==max(corr)){", file = variable.name , sep = "\n", append = TRUE)
      cat(" #log", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- exp(predict(LMlog, newdata = pred2 , type ='response'))", file = variable.name , sep = "\n", append = TRUE)
      cat(" }", file = variable.name , sep = "\n", append = TRUE)
      cat("if(correlation_accuracy_tree==max(corr)){", file = variable.name , sep = "\n", append = TRUE)
      cat(" #tree", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(rpart_model, newdata = pred2 , type = c(\"vector\", \"prob\", \"class\", \"matrix\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("if(correlation_accuracy_rf==max(corr)){", file = variable.name , sep = "\n", append = TRUE)
      cat(" #rf", file = variable.name , sep = "\n", append = TRUE)
      cat("pred2$fitted.results.var <- predict(rf.model, newdata = pred2 , type ='response')", file = variable.name , sep = "\n", append = TRUE)
      cat(" }", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Repartition of the predicted outcome ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r hist,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Plotting the histogram of the predicted outcome", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("hist(pred2$fitted.results.var, col = \"lightblue\", xlab = \"Predicted values\", ylab = \"#\", plot = TRUE, main = ", file = variable.name , sep = "\n", append = TRUE)
      cat("       paste(\"Histogram of predicted values\"))", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("####Mean value of the predicted outcome in each location ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r location,  echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Plotting the mean value of the predicted outcome in each location of asylum", file = variable.name , sep = "\n", append = TRUE)
      cat("pred$fitted.results.var <- pred2$fitted.results.var", file = variable.name , sep = "\n", append = TRUE)
      cat("try(pred$location <- subset(pred, select= location )[,1])", file = variable.name , sep = "\n", append = TRUE)
      cat("if(length(pred$location) != 0){", file = variable.name , sep = "\n", append = TRUE)
      cat("ggplot(data=pred, aes(x=location, y=sapply(fitted.results.var,mean))) +", file = variable.name , sep = "\n", append = TRUE)
      cat("  stat_summary(fun.y=\"mean\", geom=\"bar\",width=0.5) + labs(x = \"\", y = \"Mean value\") +", file = variable.name , sep = "\n", append = TRUE)
      cat("ggtitle(\"Mean value of the predicted outcome in each location\")+", file = variable.name , sep = "\n", append = TRUE)
      cat("theme(plot.title = element_text(face = \"bold\", size = 9), plot.background = element_rect(fill = \"transparent\",colour = NA))", file = variable.name , sep = "\n", append = TRUE)
      cat("}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("## Annex: Statistical results", file = variable.name , sep = "\n", append = TRUE)
      cat("###Variable selection with Random Forests", file = variable.name , sep = "\n", append = TRUE)
      cat("The algorithm choses the 10 most relevant variables according to their importance (Mean Decrease Gini):", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r selection graph, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("#Plot of most important variables", file = variable.name , sep = "\n", append = TRUE)
      cat("varImpPlot(rf.modelselect,", file = variable.name , sep = "\n", append = TRUE)
      cat("           sort = T,", file = variable.name , sep = "\n", append = TRUE)
      cat("           main=\"Variable Importance\",", file = variable.name , sep = "\n", append = TRUE)
      cat("           n.var=10)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Ordinary Least squares regression", file = variable.name , sep = "\n", append = TRUE)
      cat("OLS is a basic form of linear regression. The parameters of the linear function are chosen by minimizing the sum of the squares of the differences between the observed dependent variable (values of the variable being predicted) in the given dataset and those predicted by the linear function. The smaller the differences, the better the model fits the data. ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The following chart shows the values of the coefficients and their associated 95% confidence intervals (horizontal bars). A coefficient equal to 1.5 means that the modality increases the value of the predicted variable by 50%.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("ggcoef(LM2, exponentiate = TRUE,conf.int=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Generalized linear model", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("Sometimes the relationship between the variable of interest and the predictors cannot adequately be summarized by a simple linear equation. This could be due to a specific distribution of the dependent variable and/or to an effect of the predictors on the dependent variable that is not linear by nature. Here the dependent variable is supposed to follow a Gamma probability law distribution.", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("ggcoef(GLM, exponentiate = TRUE,conf.int=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Partial Least Square regression", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("PLS regression is a technique that generalizes and combines features from principal component analysis and multiple regression. It is particularly useful when the set of predictors is large and has multicolinearity. It reduces the predictors to a smaller set of uncorrelated components and performs least squares regression on these components, instead of on the original data.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("The following chart shows the predicted values against the measured (actual) ones fron the testing dataset. The prediction is perfect if the points follow the first bisector, which happens if predicted and actual values are equal. ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("#Using the training data, we can plot the predicted values from the training set to the actual ones", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(plsFit, ncomp=1, asp=1, line=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Least Absolute Shrinkage and Selection Operator (Lasso) regression", file = variable.name , sep = "\n", append = TRUE)
      cat("Lasso regression is a type of linear regression that uses shrinkage and variable selection. Shrinkage is where data values are contracted towards a central point, like the mean. The lasso procedure encourages simple models (with fewer parameters). This type of regression is well-suited for models showing high levels of muticollinearity (i.e. high intercorrelations or inter-associations among predictors).", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Log transformation", file = variable.name , sep = "\n", append = TRUE)
      cat("The log transformation can be used to make highly skewed distributions less skewed. This can be valuable both for making patterns in the data more interpretable and for helping to meet the assumptions of inferential statistics.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r,   echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("ggcoef(LMlog2, exponentiate = TRUE,conf.int=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(LMlog)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("### Decision tree", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("A decision tree is an algorithm that builds a tree-like graph to illustrate the possible outcomes of an event or question, here referred to as a decision. To build the tree, the algorithm first finds the predictive variable that does the best task of separating the data into two groups. Then, it repeats the above step with the other variables. This results in a tree graph, where each split represents a decision. The algorithm chooses the splits such that the maximum number of observations are classified correctly. ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r tree graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(rpart)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("# plot tree ", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rpart_model, uniform=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("text(rpart_model, use.n=TRUE, all=TRUE, cex=.8)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:rpart\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("###Random Forest ", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("In Random Forests the idea is to generate several decision trees using different samples randomly chosen from training data. The next step is to simply reduce the variance in the trees by averaging them. Averaging the trees reduces the variance and also improves the performance of decision trees on test datasets and eventually avoids overfitting (a dependency of the model on the training set so strong, it can be considered biased). The following graph shows the veolution of the error rate according to the number of trees, for each category.", file = variable.name , sep = "\n", append = TRUE)
      cat("The following graph shows the veolution of the error rate according to the number of trees, for each category.", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("```{r rf graphs, echo = FALSE, warning = FALSE, message = FALSE}", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("library(randomForest)", file = variable.name , sep = "\n", append = TRUE)
      cat("plot(rf.model)", file = variable.name , sep = "\n", append = TRUE)
      cat("detach(\"package:randomForest\", unload=TRUE)", file = variable.name , sep = "\n", append = TRUE)
      cat("```", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
      cat("", file = variable.name , sep = "\n", append = TRUE)
    }
  }



  ##  Rendering the reports #######

  for (i in 1:length(selected.predictVars)) {
    variablesname <- as.character(selected.predictVars[ i ])
    cat(paste(i, " - Render word output report for ",variablesname))
    rmarkdown::render(paste0("code/",i,"-", variablesname, "-chapter.Rmd", sep = ""))
    ## Put the report in the out folder
    file.rename(paste0("code/",i,"-", variablesname, "-chapter.docx", sep = ""), paste0("out/report-",i,"-", variablesname,Sys.Date(), "-chapter.docx"))
    ## Clean  memory
    gc()
  }



  #rmarkdown::render('report-tabulation.Rmd')

  cat(" Done!! Reports are in the folder OUT - Review the report- Adjust your configuration files and you will be very soon ready to start the qualitative analysis and the analysis workshops...")
}





